<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="mobile-web-app-capable" content="yes">

    <title>cpsh</title>
    <link href="https://fonts.googleapis.com/css?family=Roboto+Condensed" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.rawgit.com/twbs/bootstrap/v4-dev/dist/css/bootstrap.css">
    <link rel="stylesheet" href="/s/css/style.css">
    <link rel="icon" href="/s/favicon.ico">
  </head>

  <body>
    <div class="container">
      <div class="row">
        <div class="col-sm-offset-1 col-sm-9">

          <h3 class="title">
            cpsh - <small><a href="/s/">back</a></small>
          </h3>
          <div id="ui-json" class="ui">
          </div>
          <div class="footer">
            &copy;krkr
          </div>
        </div>
      </div>
    </div>

    <script id="tpl-json" type="text/ractive">
      <div class="card">
        <div class="card-block">
          <h4 class="card-title">{{category}} / {{name}}</h4>
        </div>
        <ul class="list-group list-group-flush">
          <li class="list-group-item">
            <pre id="script" class="script">
            </pre>
            <div class="input-group">
              <span class="input-group-btn">
                <button class="btn btn-primary-outline btn-curl-name" data-clipboard-target="#{{name}}">
                    Copy to clipboard
                </button>
              </span>
              <input type="text" id="{{name}}" class="curl-snippet form-control" readonly value="{{curl}}" onclick="this.select();">
            </div>
          </li>
        </ul>
      </div>
    </script>

    <script src="http://cdn.ractivejs.org/latest/ractive.min.js"></script>
    <script src="https://cdn.rawgit.com/zenorocha/clipboard.js/master/dist/clipboard.min.js"></script>
    <script src="/s/js/script.js"></script>

    <script>
        function showTooltip(elem, msg) {
            elem.setAttribute('class', 'btn tooltipped tooltipped-s');
            elem.setAttribute('aria-label', msg);
        }

        var clipboard = new Clipboard('.btn');
        clipboard.on('success', function(e) {
            showTooltip(e.trigger, 'Copied!');
        });

        var category = getParam("c");
        var name = getParam("n");
        var curl = getParam("curl");

        get("/s/curl/" + category + "/" + name, function(data) {

            var btns = document.querySelectorAll('.btn');
            for (var i = 0; i < btns.length; i++) {
                btns[i].addEventListener('mouseleave', function(e) {
                    e.currentTarget.setAttribute('class', 'btn btn-primary-outline');
                    e.currentTarget.removeAttribute('aria-label');
                });
            }

            new Ractive({
                el: "#ui-json", template: "#tpl-json",
                data: {
                  category: category,
                  name: name,
                  curl: curl
                },
                oncomplete: function() {
                  document.getElementById("script").innerHTML = data;
                }
            });
        }, undefined, true);
    </script>

  </body>
</html>
